= vext - the high-performance IRC notification daemon for version control systems

image:https://img.shields.io/badge/License-MPL_2.0-blue.svg[MPL-2.0,link="https://opensource.org/licenses/MPL-2.0"]
image:https://img.shields.io/badge/Philosophy-Palimpsest-purple.svg[Palimpsest,link="https://github.com/hyperpolymath/palimpsest-licence"]

:toc: macro
:toc-title: Contents
:sectnums:

image:[Rust 1.70+]
image:[Deno 1.40+]
image:[RSR Compliance]

== Overview

*vext* is a high-performance IRC notification daemon for version control systems. It provides real-time commit notifications from Git repositories to IRC channels, with connection pooling to eliminate join/leave spam.

This is a modernized rewrite of the original link:http://www.catb.org/~esr/irker/[irker] by Eric S. Raymond, built with:

* *Rust* - High-performance async daemon with memory safety
* *Deno/TypeScript* - Modern hook scripts and CLI tools

== Features

* *Async I/O*: Built on Tokio for efficient handling of thousands of connections
* *Connection Pooling*: Maintains persistent IRC connections, eliminating join/leave spam
* *TLS Support*: Secure connections to IRC servers (enabled by default)
* *Rate Limiting*: Built-in flood protection with token bucket algorithm
* *Multi-Target*: Send notifications to multiple channels/servers simultaneously
* *JSON Protocol*: Simple, language-agnostic notification format
* *Color Support*: Optional mIRC color codes for enhanced visibility

== Architecture

[source]
----
┌─────────────────┐     JSON/TCP      ┌─────────────────┐
│   Git Hook      │ ───────────────▶  │   vextd         │
│   (Deno/TS)     │                   │   (Rust)        │
└─────────────────┘                   └────────┬────────┘
                                               │
                                     ┌─────────┴─────────┐
                                     │  Connection Pool  │
                                     └─────────┬─────────┘
                                               │
                              ┌────────────────┼────────────────┐
                              ▼                ▼                ▼
                        ┌──────────┐    ┌──────────┐    ┌──────────┐
                        │ IRC #ch1 │    │ IRC #ch2 │    │ IRC #ch3 │
                        └──────────┘    └──────────┘    └──────────┘
----

== Quick Start

=== Prerequisites

* Rust 1.70+ (install via link:https://rustup.rs[rustup])
* Deno 1.40+ (install via link:https://deno.land[deno.land])

=== Building

[source,bash]
----
# Clone the repository
git clone https://github.com/Hyperpolymath/vext.git
cd vext

# Build everything
just build

# Or build components separately
cargo build --release          # Rust daemon
cd vext-tools && deno check src/**/*.ts  # Deno tools
----

=== Running the Daemon

[source,bash]
----
# Start daemon (listens on 127.0.0.1:6659 by default)
./target/release/vextd

# Start with custom settings
./target/release/vextd --listen 0.0.0.0:6659 --default-server irc.libera.chat

# Debug mode
./target/release/vextd -vv
----

=== Installing Git Hook

[source,bash]
----
# Install hook to a repository
cd /path/to/your/repo
deno run --allow-read --allow-write \
  https://raw.githubusercontent.com/Hyperpolymath/vext/main/vext-tools/src/hooks/install.ts

# Configure the hook
export VEXT_TARGETS="ircs://irc.libera.chat/your-channel"
export VEXT_PROJECT="your-project"
----

=== Sending Notifications

[source,bash]
----
# Using the CLI
./target/release/vext-send \
  --to "ircs://irc.libera.chat/your-channel" \
  --message "Hello from vext!" \
  --project "myproject"

# Or via netcat
echo '{"to":["ircs://irc.libera.chat/test"],"privmsg":"Test message"}' | nc localhost 6659
----

== Configuration

=== Daemon Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--listen`
|Listen address
|`127.0.0.1:6659`

|`--default-server`
|Default IRC server
|`irc.libera.chat`

|`--default-port`
|Default IRC port
|`6697`

|`--tls`
|Enable TLS
|`true`

|`--max-connections`
|Max connections per server
|`4`

|`--nick`
|Bot nick prefix
|`vext`

|`-v, -vv`
|Verbose logging
|INFO
|===

=== Hook Environment Variables

[cols="1,2"]
|===
|Variable |Description

|`VEXT_SERVER`
|vextd server address (default: `127.0.0.1:6659`)

|`VEXT_TARGETS`
|Comma-separated IRC target URLs

|`VEXT_PROJECT`
|Project name for notifications

|`VEXT_URL`
|Base URL for commit links

|`VEXT_MAX_COMMITS`
|Max commits to report per push (default: 5)
|===

== Notification Protocol

Send JSON notifications to the daemon over TCP:

[source,json]
----
{
  "to": ["ircs://irc.libera.chat/channel1", "irc://irc.oftc.net/channel2"],
  "privmsg": "[project] main abc1234 dev: Add new feature",
  "project": "myproject",
  "branch": "main",
  "commit": "abc1234",
  "author": "developer",
  "url": "https://github.com/user/repo/commit/abc1234",
  "colors": "mirc"
}
----

=== IRC URL Format

* `irc://server/channel` - Plain connection (port 6667)
* `ircs://server/channel` - TLS connection (port 6697)
* `irc://server:port/channel` - Custom port
* `irc://server/channel?key=secret` - Channel with key

== Development

[source,bash]
----
# Run tests
just test

# Format code
just format

# Lint
just lint

# Full validation
just validate
----

== Project Structure

[source]
----
vext/
├── vext-core/           # Rust daemon
│   ├── src/
│   │   ├── main.rs      # Entry point
│   │   ├── config.rs    # Configuration
│   │   ├── irc_client.rs# IRC protocol
│   │   ├── listener.rs  # TCP/UDP listener
│   │   ├── pool.rs      # Connection pooling
│   │   └── protocol.rs  # Notification types
│   └── Cargo.toml
├── vext-tools/          # Deno hooks & tools
│   ├── src/
│   │   └── hooks/
│   │       ├── git.ts   # Git post-receive hook
│   │       └── install.ts
│   └── deno.json
└── justfile             # Build automation
----

== License

Dual-licensed under MIT OR AGPL-3.0-or-later (Palimpsest licensing).

Choose the license that works best for your use case.

== Credits

* Original link:http://www.catb.org/~esr/irker/[irker] by Eric S. Raymond
* Modernized by the vext contributors

== Links

* link:https://github.com/Hyperpolymath/vext[GitHub Repository]
* link:https://github.com/Hyperpolymath/vext/issues[Issue Tracker]
* link:CHANGELOG.md[Changelog]
* link:CONTRIBUTING.md[Contributing Guide]
